# 0-2.アーキテクチャ

Vue.jsを利用したアーキテクチャ構成配下のようになります。これはあくまで一例で、今後変わるおそれもありますし、他の構成もありえます。

また、これはデプロイ周り、サーバーサイド周りのアーキテクチャは含まれていません。あくまで、1フロントプロジェクトを囲う技術スタックと思ってください。

![アーキテクチャ構成図](./%E3%82%A2%E3%83%BC%E3%82%AD%E3%83%86%E3%82%AF%E3%83%81%E3%83%A3.png)

## ランタイム環境

### Node.js

- クライアント開発ですが、ランタイム環境の選定は重要です。
- CDNでライブラリのインストールなどはせずNPM経由でインストールします。
- 後述のviteやwebpackでビルドする必要があるため、javascriptのOSでのランタイム環境は必須です。

別案として出てきているのが、deno。複雑化しているnode_modulesを解決すべく、URLでパッケージを参照できるコーディングを実現してくれます。

一応denoのほうがインストールしたパッケージに対して、`arrow-〇〇`でアクセス制御などがかけられるため、npmパッケージへの脆弱性混入攻撃などにほんのり強いです。

が、今回は知見が少ないので、nodeにします。

## 開発フレームワーク

### Nuxt

Vue.jsの開発体験をより向上させるためのフレームワーク。SSRかSPAか、ディレクトリ構成、ルーティングなど、Vueで開発する上での面倒ごとをある程度解決してくれるフレームワークです。プロダクト全体の設定は`nuxtConfig.ts`ファイルに格納されているため、設定が分散しにくい特徴があります。

採用されないケースもあり、Vue 3対応のNuxt3は現在RFC版のため今回は採用を見送りました。

## ビルドツール

### webpack

javascript用のモジュールバンドラーで、jsだけでなく、HTML,CSS、画像などをまとめてビルドすることができます。

しかし、フロントで取り扱うアプリが大規模になればなるほどそのビルド速度は遅くなり、開発のボトルネックになってきています。

ホットモジュールリロード(HMR)機能も搭載されています。

### Vite

esbuildとrollupを用いた新しいビルドツール。Vueに限らずReactなどでも利用することができます。

HMRも差分更新のため開発規模にリロード速度が比例しにくいのが特徴です。

webpackに比べ、設定もとっつきやすいので今回はこちらを利用しました。

### Turbopack

Nextjs13に内蔵された、Rust製の新しいビルドツール。現在、Reactのみに対応している状況だが、Vueなどにも対応予定らしい。TurbopackのVue対応版がリリースされた暁にはこちらに移行するのもありかもしれない。

Viteより速いらしい。

## Linter Formatter

インデントをそろえたりシングルクォートなのか、ダブルクォートなのかをチェックする作業は21世紀の人類の仕事ではありません。

エラーや潜在的なバグを警告するものがlinterで

コーディングスタイルを統一するのがFormatterです。

Linterは特定の言語にだけ紐づき、Formatterは広い範囲でコーディングをカバーできます。範囲が広ければ広いほど、指定できるルールが少なくなる傾向があるので、うまく使い分ける必要があります。

### ESLint

javascript専用のLinterです。

ルールやプラグインが非常に多く、理想のルール作りはとても大変ですが、一度ルールを取り決めることができれば長い期間プロジェクトに貢献してくれます。ただ、メンテされにくいものなので注意が必要です。

TypeScriptプラグイン、Nuxtプラグイン、Vueプラグイン、などがあり、適宜必要に応じて入れてく必要があります。

VisualStudioCodeの拡張と併せて使うことでファイル保存時に自動でLinterのルールに合わせ手コードを保存してくれる機能があるため、手動でのフォーマットが不要になります。

### Prettier

Vue, CSS, Javascript, TypeScript, JSX, TSX, yaml, markdown HTML, GraphQLなどに対応したコードフォーマッター。

こちらもVisualStudioCodeの拡張と合わせて使うことで、保存時に自動修正をしてくれます。

### editorConfig

すべてのファイルに対応したフォーマッター。改行コードなどプロダクト全体で揃えたいルールがある場合に有用。拡張子ごとに細かいルールもしけます。

これもVisualStudioCodeの拡張と合わせて使うことで保存時に自動修正を行えます。.NETでの開発などではこちらを採用するケースも多いです。

### ルールのバッティング

自動保存が便利だからといって、多量の拡張を一つの拡張子に当てると、お互いのルールがバッティングしあい、保存してもエラーが消えない現象が発生します。少ないFormatterとLinterで広くをカバーすることが望ましいです。

## Vue.jsのサポートツール

Vue.jsを利用する上で追加でほしいツールです。図では公式から提供されているもの, 公式が推奨しているものを紹介します。

### Vue Router

仮想DOMフレームワークはHTMLのページを保持しているわけではありません。そのため、ページングの機能を用意するためにはサポートツールが専用で必要になります。

ページのルーティングを補助するVueRouterを使うのが一般的ですが、Nuxt.jsには最初からこの昨日がサポートされているため、わざわざインストールする必要性はありません。

### Vuex (Pinia)

Vue.jsではHTMLのようにツリー状にコンポーネントがぶら下がっています。データはバケツリレーのように、親コンポーネントから子コンポーネントに渡されます。

データを親から子へ、バケツリレーで渡していくのを記載するのはなかなか骨の折れる作業です。

それを解消するのがVuexのようなState管理ツールになります。State管理ツールはstateと呼ばれる変数をデータとして保持しておきます。

すべてのコンポーネントはこのstateへ自由にアクセスができるため、バケツリレーでデータを受け取る必要がなくなります。

VuexはTypeScriptと致命的に相性が悪いため、Piniaが公式では推奨されています。実際今回のプロダクトでもPiniaを利用したいと思います。

### VueUse

今回は利用しませんが、VueUseというVue用十徳ナイフのようなパッケージがあります。

- カーソルのポジションを取得する
- 要素二ホバーしたときのイベントハンドラを用意する
- Dateをフォーマットする

などなどフロントエンドで開発をしていると欲しくなる機能がたくさん詰められ、それが1コードで記述できるすぐれものです。

Vueが公式に提供しているものでもあり、導入障壁も低いです。

## テスト

### jest

クライアントもテストコードが書けます。jestはjavascript向けのテストフレームワークとしてとても有名です。

簡単にMockすることができるため、自分ができる範囲からテストを始められる点が優れています。

### vitest

jestベースで書くことができるViteで動かせるテストフレームワークです。

一応Jestより高速で動作すると言われていますが、実際のところはよくわかりません。

今回は折角viteをバンドルツールとして採用しているのでVitestでテストコードを書いていきます。

## CSSフレームワーク

会社にデザイナーがいない場合、UIフレームワークを利用することが多くなります。VueにもBootstrapのようなUIフレームワークはいくつもあります。

基本的にUIフレームワークはプロダクトにおいて最後にどうするか決めたほうがいいです。自分でUIフレームワークを賄っていない場合、コンポーネントが要件を満たす機能が備わっているかわからないためです。

なるべく画面でどんな動きをさせたいのか、決まってからUIフレームワーク選定に移行したほうが無難です。

### Vuetify

簡単で使いやすいUIフレームワーク集です。Vue2からある古参なコンポーネント集で、ほとんどのコンポーネントが直感的に動かせます。

ただ、簡単に扱えますが、ツリーシェイキングなどの設定をきちんと施さないとパフォーマンスが悪化することも多々あります。設定周りに関してはしっかり確認するようにしましょう。

## その他

その他のツールです。フロントエンド開発をしていると必要になることがしばしばあり、インストールします。

### Axios

Node.js ブラウザ 両方で動作するHTTPリクエストのサポートツールです。

設定で共通のヘッダーなどを用意しておくことができますので、Fetchなどを利用するより使いやすいことが多いです。

### SocketIO

Webソケットを利用した通信を行えるツールです。チャットなどのリアルタイム通信サービスを開発する際に用いられます。

Webソケットによる通信はサーバー側で採用されているフレームワークに引っ張られることが多いので、必ずしもSocketIOを利用するとは限りません。

他に、

- SignalR
- Firebase

などのリアルタイム通信ツールがあります。

サーバー側と合わせて、どれを採用するのか検討しましょう。

## アーキテクチャは不変じゃない

今紹介した構成図がいつでもずっと利用できるとは限りません。

今紹介したツール群の中で最も古株のNode.jsのnode_modulesはNode.js自身にもどうすることもできなくなっている負債になりつつあります。

大事なのはそういった状態をなんとかしようとする声とそれを解決せんとする新しいツール群を見逃さないことです。

実際、Node.js以外にランタイム環境としてdenoというランタイムツールが昨今台頭しつつあります。denoはネット上からライブラリをimportできるためローカル環境を汚さずに開発を進めることもできます。denoを導入するかはさておいて選択肢として持っておくことが大事になります。

こういった情報に対してアンテナを張っておくにはどうすればいいか？私は明確な答えを持ってはいませんが私のやっていることだけ書いておきます。

- 開発者向けコミュニティでフロントエンド関係の情報をフォローする
  - [DEV](https://dev.to) 海外の開発者向けコミュニティ。Qiitaみたいなもの。記事二タグ付けでき、タグをフォローできる。関係ない話ですが本当に爆速のサイトなのでパフォーマンス周りがきになる人はどうやってこのサイトができているのか見てみるのも面白いと思います。
  - [Echo JS](https://www.echojs.com/) hacker newsのようなユーザーが関心をもったニュースがランキングに上がってくるタイプのニュースまとめサイト。そのjavascript版
  - [JSer.Info](https://jser.info/) azuさんというjavascriptのOSS関係で働かれている方がまとめているjsまわりのニュース。私はRSS登録して個人のSlackチャンネルに投稿が流れてくるようにしています。
  - [Qiita](http://qiita.com/) お気持ちポエムや、初学者のメモなどが流れてくることもあり、かなりノイジーな場所ですがタグで興味のあるコンテンツをフォローしておいて損はないと思います。
- 開発者をSNSでフォローする - インフルエンサーとかは善し悪しの見分けが付かないので、自分が使うOSSのコントリビュータや知ってるサービスの開発者だけフォローしています。
  - [Evan You](https://twitter.com/youyuxi) Vueを立ち上げた人。Viteなどの開発もされています。OSS開発者としての思いが強い方です。Next.jsのトランスパイラにViteとの速度を比較された時、公正な比較をされず現実の製品のように誇大広告に利用された時、実際に比較検証、反論をされたことでも有名です。
  - [増井俊之](https://scrapbox.io/masui/) scrapbox, gyazo, ガラケーの予測変換システムPOBoxの開発者。元Apple勤務。UI/UXに関する造詣が深いです。
  - [橋本商会](https://scrapbox.io/shokai/shokai) scrapboxを開発されているエンジニアの方です。javascriptの実装で困ったことがあったときにその手法をたまたままとめられていたりしたのでフォローしています。
  - [西尾泰和](https://scrapbox.io/nishio/) サイボウズのデータサイエンティストの方です。エンジニアの知的生産性を上げるために日々研究をされています。本稿とは関係ないですが、ChatGPTのEmbeddingAPIを参考にしたり、kozanebaというサービスの思想に感銘を受けました。
  - [katashin](https://katashin.info/about/) Vuexのコントリビュータです。Vuexの型定義について考えるときに大変参考にさせていただきました。
  - [Ryan Dhal](https://tinyclouds.org/) Node.jsの作者であり、denoの作者です。Node.jsを作成しながら2013年頃そこから離れ、2018年に新しくNodeの問題点を改善したdenoを開発したという変わった経歴を持っています。
  - [azu](https://github.com/azu) JSerInfoを作られた方。JavascriptPrimerというJavascriptの初学者向けの本を書かれた人でもあり、javascriptに対して造形が深いです。
- カンファレンスに参加する。 自分の興味ある分野のカンファレンスに偶に参加します。VueFesは面白かったです。
  - [VueFes 2022](https://vuefes.jp/2022/) VueFesの2022年版です。

基本的に自分が使うサービスやライブラリで感動した機能や設計をされた人をフォローしてます。
